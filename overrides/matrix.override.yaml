# Matrix service override for self-hosting infrastructure
# This file connects Matrix nginx to the shared tunnel network
# Port exposure removed - LAN proxy handles routing

services:
  nginx:
    container_name: matrix-nginx
    labels:
      - "wud.watch=true"
      - "wud.tag.include=.*-alpine$$"  # Alpine variants only
    ports: !override
      # Remove HTTP port - proxy handles it
      # Keep federation port exposed directly (needs SSL)
      - "${LOCAL_IP}:8448:8448"
    networks:
      - net        # Internal Matrix network (from base compose)
      - web        # External tunnel network (shared)

  synapse:
    labels:
      - "wud.watch=true"
      - "wud.tag.include=^v.*"  # Versions starting with v

  db:
    labels:
      - "wud.watch=true"
      - "wud.tag.include=.*-alpine$$"  # Alpine variants only

  element:
    labels:
      - "wud.watch=true"
      - "wud.tag.include=^v.*"  # Versions starting with v

networks:
  web:
    external: true
    name: web
  net:
    # References the 'net' network from matrix docker-compose.yaml
